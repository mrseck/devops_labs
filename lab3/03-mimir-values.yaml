# Values pour Helm chart mimir-distributed
mimir:
  structuredConfig:
    target: all
    multitenancy_enabled: true
    
    # Désactiver ingest_storage (Kafka) pour environnement de lab
    ingest_storage:
      enabled: false
    
    # Stockage S3 - blocks_storage pour les blocs de métriques
    blocks_storage:
      backend: s3
      s3:
        endpoint: minio.minio.svc.cluster.local:9000
        bucket_name: mimir-blocks
        access_key_id: minioadmin
        secret_access_key: minioadmin123!
        insecure: true
    
    # Stockage pour les règles
    ruler_storage:
      backend: s3
      s3:
        endpoint: minio.minio.svc.cluster.local:9000
        bucket_name: mimir-ruler
        access_key_id: minioadmin
        secret_access_key: minioadmin123!
        insecure: true
    
    # Stockage pour Alertmanager
    alertmanager_storage:
      backend: s3
      s3:
        endpoint: minio.minio.svc.cluster.local:9000
        bucket_name: mimir-alertmanager
        access_key_id: minioadmin
        secret_access_key: minioadmin123!
        insecure: true
    
    # Limites
    limits:
      max_global_series_per_user: 1000000
      max_global_series_per_metric: 20000
      ingestion_rate: 100000
      ingestion_burst_size: 200000
      max_query_parallelism: 32
      compactor_blocks_retention_period: 8760h  # 365 jours
    
    # Compaction
    compactor:
      compaction_interval: 30m
      deletion_delay: 2h
    
    # Multi-tenancy
    # OrgID "pods" pour métriques applicatives
    # OrgID "nodes" pour métriques infrastructure

# Composants Mimir
distributor:
  replicas: 3
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 1Gi
      cpu: 500m

ingester:
  replicas: 3
  persistence:
    enabled: true
    size: 20Gi
  resources:
    requests:
      memory: 4Gi
      cpu: 2000m
    limits:
      memory: 8Gi
      cpu: 4000m

querier:
  replicas: 2
  resources:
    requests:
      memory: 2Gi
      cpu: 1000m
    limits:
      memory: 4Gi
      cpu: 2000m

queryFrontend:
  replicas: 2
  resources:
    requests:
      memory: 1Gi
      cpu: 500m
    limits:
      memory: 2Gi
      cpu: 1000m

storeGateway:
  replicas: 2
  resources:
    requests:
      memory: 2Gi
      cpu: 1000m
    limits:
      memory: 4Gi
      cpu: 2000m

compactor:
  replicas: 1
  resources:
    requests:
      memory: 2Gi
      cpu: 1000m
    limits:
      memory: 4Gi
      cpu: 2000m

ruler:
  replicas: 2
  resources:
    requests:
      memory: 1Gi
      cpu: 500m
    limits:
      memory: 2Gi
      cpu: 1000m

alertmanager:
  replicas: 3
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 1Gi
      cpu: 500m

# Service Monitor
monitoring:
  serviceMonitor:
    enabled: true
    interval: 30s

