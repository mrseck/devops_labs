# Values pour Helm chart loki-distributed
loki:
  auth_enabled: false
  
  commonConfig:
    replication_factor: 1
    instance_addr: 0.0.0.0
  
  storageConfig:
    boltdb_shipper:
      active_index_directory: /var/loki/index
      cache_location: /var/loki/cache
      cache_ttl: 168h
      shared_store: s3
    aws:
      endpoint: minio.minio.svc.cluster.local:9000
      s3forcepathstyle: true
      insecure: true
      secret_access_key: minioadmin123!
      access_key_id: minioadmin
      region: us-east-1
      bucketnames: loki-data
  
  schemaConfig:
    configs:
      - from: "2024-01-01"
        store: boltdb-shipper
        object_store: s3
        schema: v11
        index:
          prefix: index_
          period: 24h
  
  compactor:
    enabled: true
    replicas: 1
    retentionEnabled: true
    retentionDeleteDelay: 2h
    retentionDeleteWorkerCount: 150
  
  limits_config:
    ingestion_rate_mb: 10
    ingestion_burst_size_mb: 20
    max_query_length: 721h
    retention_period: 2160h  # 90 jours par d√©faut
    per_stream_rate_limit: 3MB
    per_stream_rate_limit_burst: 15MB
  
  retention_config:
    enabled: true
    delete_store_retention_period: 2160h
  
  # Configuration par namespace
  table_manager:
    retention_deletes_enabled: true
    retention_period: 2160h

# Composants Loki
distributor:
  replicas: 3
  maxUnavailable: 1
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 1Gi
      cpu: 500m

ingester:
  replicas: 3
  maxUnavailable: 1
  persistence:
    enabled: true
    size: 10Gi
  resources:
    requests:
      memory: 2Gi
      cpu: 500m
    limits:
      memory: 4Gi
      cpu: 1000m

querier:
  replicas: 2
  maxUnavailable: 1
  resources:
    requests:
      memory: 1Gi
      cpu: 500m
    limits:
      memory: 2Gi
      cpu: 1000m

queryFrontend:
  replicas: 2
  maxUnavailable: 1
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 1Gi
      cpu: 500m

compactor:
  replicas: 1
  resources:
    requests:
      memory: 1Gi
      cpu: 500m
    limits:
      memory: 2Gi
      cpu: 1000m

# Service Monitor pour Prometheus
monitoring:
  serviceMonitor:
    enabled: true
    interval: 30s

